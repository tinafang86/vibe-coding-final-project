<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„é£Ÿç‰©æ¸…å–®</title>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&family=Noto+Sans+TC:wght@400;700&display=swap"
        rel="stylesheet">
    <!--  æ”¾å…¥é€™ä¸‰è¡Œé–‹å§‹ -->
    <link rel="icon" type="image/png" href="./icon.png">
    <link rel="apple-touch-icon" href="./icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./icon.png">
    <!--  æ”¾å…¥é€™ä¸‰è¡ŒçµæŸ -->
    <style>
        /* CSS æ¨£å¼ï¼šæ‘©çˆ¾èŠåœ’é¢¨æ ¼ V2.1 (å–®æ¬„è¡¨å–®ï¼Œä¸ç ´è¡Œï¼Œç´°ç¯€åŠ å¼·) */
        :root {
            --mola-green-light: #F4FEE4;
            --mola-green-dark: #4CAF50;
            --mola-brown: #8D6E63;
            --mola-wood-light: #FFFAE6;
            --mola-soil: #5D4037;
            --mola-alert-low: #FFC107;
            --mola-alert-danger: #E53935;
            --mola-font-main: 'Varela Round', 'Noto Sans TC', sans-serif;
            --mola-font-normal: 'Noto Sans TC', sans-serif;
        }

        body {
            background-color: var(--mola-green-light);
            font-family: var(--mola-font-normal);
            color: var(--mola-soil);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            background-image: linear-gradient(to bottom, #E0F2B0 0%, #F4FEE4 100%);
        }

        .mola-main-barn {
            width: 100%;
            max-width: 750px;
            background-color: var(--mola-wood-light);
            border: 6px solid var(--mola-brown);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 8px 8px 0px rgba(0, 0, 0, 0.3), inset 0 0 10px rgba(0, 0, 0, 0.1);
            position: relative;
            transition: transform 0.3s;
        }

        h1,
        h2,
        #mola-list-title,
        #mola-history-title {
            font-family: var(--mola-font-main);
            color: var(--mola-green-dark);
            text-align: center;
            font-weight: 700;
            text-shadow: 2px 2px 0px var(--mola-wood-light), 4px 4px 0px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 10;
        }

        h1 {
            font-size: 3em;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            border-bottom: 4px dashed var(--mola-brown);
            padding-bottom: 15px;
            margin-bottom: 25px;
            margin-top: 0;
        }

        h1::before {
            content: "ğŸŒ°";
            font-size: 1.2em;
            animation: bounce 1s infinite alternate;
        }

        @keyframes bounce {
            from {
                transform: translateY(0);
            }

            to {
                transform: translateY(-5px);
            }
        }

        h2 {
            font-size: 1.8em;
            text-align: left;
            padding-left: 15px;
            color: var(--mola-brown);
            text-shadow: 1px 1px 0px rgba(255, 255, 255, 0.7);
            margin-bottom: 15px;
        }

        h2::before {
            content: "ğŸŒ± ";
        }

        #mola-list-title {
            font-size: 2em;
            text-align: left;
            margin-top: 40px;
            margin-bottom: 25px;
            justify-content: flex-start;
        }

        #mola-list-title::before {
            content: "ğŸ§º";
            margin-right: 10px;
        }

        #mola-history-title {
            font-size: 1.8em;
            color: var(--mola-soil);
            border-top: 2px dashed var(--mola-brown);
            padding-top: 20px;
            margin-top: 40px;
            margin-bottom: 20px;
            text-shadow: none;
        }

        #mola-history-title::before {
            content: "ğŸ“œ";
            margin-right: 10px;
        }

        /* è¡¨å–®å€å¡Š */
        /* === æ ¸å¿ƒä¿®æ”¹ï¼šå¾ 1fr 2fr æ”¹ç‚º 1frï¼Œè®“æ¯å€‹é …ç›®ä½”æ»¿ä¸€è¡Œ === */
        #mola-form-seedbox {
            display: grid;
            grid-template-columns: 1fr;
            /* å–®æ¬„ä½ˆå±€ */
            gap: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 4px double var(--mola-green-dark);
            border-radius: 15px;
            background-color: #E8F5E9;
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.1);
        }

        /* .form-group ä¸éœ€è¦ç‰¹åˆ¥è¨­ç½® grid-column äº†ï¼Œå› ç‚ºå®ƒé è¨­å°±æœƒä½”æ»¿å–®æ¬„ */
        .full-width {
            grid-column: 1 / -1;
            text-align: center;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        /* è®“ label å’Œ input å‚ç›´æ’åˆ— */
        .form-group label {
            font-family: var(--mola-font-main);
            font-size: 1.1em;
            color: var(--mola-brown);
            font-weight: 700;
            margin-bottom: 5px;
        }

        input[type="text"],
        input[type="date"],
        input[type="number"],
        select {
            border: 2px solid var(--mola-brown);
            border-radius: 8px;
            padding: 10px;
            font-family: var(--mola-font-normal);
            background-color: var(--mola-wood-light);
            transition: border-color 0.2s;
            width: 100%;
            box-sizing: border-box;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--mola-green-dark);
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.5);
        }

        button[type="submit"] {
            font-family: var(--mola-font-main);
            background-color: var(--mola-green-dark);
            color: var(--mola-wood-light);
            border: 3px solid var(--mola-brown);
            border-radius: 30px;
            padding: 12px 30px;
            font-size: 1.2em;
            cursor: pointer;
            box-shadow: 3px 3px 0px rgba(0, 0, 0, 0.3);
            transition: all 0.1s;
            margin-top: 10px;
        }

        button[type="submit"]:hover {
            background-color: #81C784;
            box-shadow: 1px 1px 0px rgba(0, 0, 0, 0.3);
            transform: translateY(2px) translateX(2px);
        }

        .filter-section {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 10px 15px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            border: 1px dashed #BDBDBD;
        }

        .filter-section label {
            font-family: var(--mola-font-main);
            color: var(--mola-soil);
            font-weight: 700;
        }

        /* æ¸…å–®æ¨£å¼ (ç¶­æŒä¸è®Šï¼Œå› ç‚ºæ¸…å–®ä½ˆå±€æ²’æœ‰æ”¹è®Š) */
        #mola-list-harvest,
        #mola-list-history {
            list-style: none;
            padding: 0;
            margin: 0;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .mola-item-produce {
            display: grid;
            grid-template-columns: 3fr 1fr auto;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            border-radius: 15px;
            border: 2px solid var(--mola-green-dark);
            background-color: var(--mola-wood-light);
            box-shadow: 2px 2px 0px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .mola-item-details {
            display: flex;
            flex-direction: column;
            text-align: left;
        }

        .mola-item-name {
            font-family: var(--mola-font-main);
            font-size: 1.4em;
            color: var(--mola-green-dark);
            font-weight: 700;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* é˜²æ­¢åç¨±éé•·ç ´è¡Œ */
        .mola-item-dates {
            font-size: 0.9em;
            color: var(--mola-soil);
            line-height: 1.5;
        }

        .mola-item-days-left {
            font-family: var(--mola-font-main);
            padding: 8px 12px;
            border-radius: 10px;
            text-align: center;
            min-width: 110px;
            font-size: 1.1em;
            font-weight: bold;
            line-height: 1.2;
        }

        .mola-delete-btn {
            background-color: var(--mola-alert-danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1em;
            line-height: 1;
            box-shadow: 2px 2px 0px rgba(0, 0, 0, 0.3);
            transition: transform 0.1s;
        }

        .mola-delete-btn:hover {
            background-color: #C62828;
            transform: scale(1.05);
        }

        /* ç‹€æ…‹é¡è‰²åŠ å¼· */
        .status-safe {
            background-color: #E6F7DF;
            color: #1B5E20;
            border-color: #A5D6A7;
            box-shadow: inset 0 0 5px #81C784;
        }

        .status-safe::before {
            content: "ğŸŒ±";
        }

        .status-low {
            background-color: var(--mola-alert-low);
            color: #FF6F00;
            border-color: #FFD54F;
            animation: pulse-yellow 1s infinite alternate;
            box-shadow: 0 0 8px var(--mola-alert-low);
        }

        .status-low::before {
            content: "ğŸ””";
        }

        .status-danger {
            background-color: var(--mola-alert-danger);
            color: var(--mola-wood-light);
            border-color: #D32F2F;
            animation: pulse-red 0.5s infinite;
            box-shadow: 0 0 10px var(--mola-alert-danger);
        }

        .status-danger::before {
            content: "ğŸš¨";
        }

        /* æ­·å²è³‡æ–™å°ˆå±¬æ¨£å¼ */
        .status-expired {
            background-color: #E0E0E0;
            color: #757575;
            border-color: #BDBDBD;
            font-style: normal;
            opacity: 0.7;
            text-decoration: line-through;
        }

        .status-expired .mola-delete-btn {
            background-color: #9E9E9E;
        }

        .status-expired .mola-delete-btn:hover {
            background-color: #757575;
        }

        .status-expired::before {
            content: "ğŸ—‘ï¸";
        }

        @keyframes pulse-yellow {
            from {
                transform: scale(1);
            }

            to {
                transform: scale(1.02);
                box-shadow: 0 0 10px 0px var(--mola-alert-low);
            }
        }

        @keyframes pulse-red {
            from {
                transform: scale(1);
                opacity: 1;
            }

            to {
                transform: scale(1.03);
                opacity: 0.8;
            }
        }

        /* RWD èª¿æ•´ */
        @media (max-width: 600px) {
            .mola-item-produce {
                grid-template-columns: 1fr auto;
                gap: 10px;
                grid-template-areas: "details daysleft" "details deletebtn";
            }

            .mola-item-details {
                grid-area: details;
            }

            .mola-item-days-left {
                grid-area: daysleft;
                min-width: unset;
            }

            .mola-delete-btn {
                grid-area: deletebtn;
                justify-self: end;
            }

            .mola-item-name {
                font-size: 1.2em;
            }

            .mola-item-dates {
                font-size: 0.8em;
            }
        }
    </style>
</head>

<body>
    <div class="mola-main-barn">
        <h1>ğŸŒ° ä¼™é£Ÿå€‰åº« ğŸ§º</h1>

        <form id="mola-form-seedbox">
            <h2>ğŸŒ± æˆ‘çš„é£Ÿç‰©</h2>
            <div class="form-group">
                <label for="category">é£Ÿç‰©é¡åˆ¥</label>
                <select id="category">
                    <option value="æ°´æœ">ğŸ æ°´æœ</option>
                    <option value="è”¬èœ">ğŸ¥¦ è”¬èœ</option>
                    <option value="éº¥å­">ğŸŒ¾ éº¥å­</option>
                    <option value="æ¼ç²">ğŸ£ æ¼ç²</option>
                    <option value="é»å¿ƒ">ğŸ° é»å¿ƒ</option>
                    <option value="é£²å“">ğŸ¥¤ é£²å“</option>
                    <option value="æ¼¿æœ">ğŸŸ£ æ¼¿æœ</option>
                    <option value="åŠ å·¥å“">ğŸ§ª åŠ å·¥å“</option>
                    <option value="èª¿å‘³">ğŸ§‚ èª¿å‘³</option>
                    <option value="å…¶ä»–">â“ å…¶ä»–</option>
                </select>
            </div>
            <div class="form-group">
                <label for="name">åç¨±</label>
                <input type="text" id="name" required placeholder="ä¾‹å¦‚ï¼šç¥å¥‡å—ç“œ">
            </div>
            <div class="form-group">
                <label for="purchaseDate">è³¼è²·æ—¥æœŸ</label>
                <input type="date" id="purchaseDate" required>
            </div>
            <div class="form-group">
                <label for="expiryDate">ä¿å­˜æœŸé™</label>
                <input type="date" id="expiryDate" required>
            </div>
            <div class="form-group">
                <label for="quantity">æ•¸é‡</label>
                <input type="number" id="quantity" min="1" value="1" required>
            </div>
            <div class="full-width">
                <button type="submit">ğŸ“¦ ç™»è¨˜åº«å­˜</button>
            </div>
        </form>

        <h2 id="mola-list-title">ğŸ§º åº«å­˜æ¸…å–®</h2>

        <div class="filter-section">
            <label for="category-filter">é¡åˆ¥ç¯©é¸</label>
            <select id="category-filter">
                <option value="all">æ‰€æœ‰é¡åˆ¥</option>
                <option value="æ°´æœ">ğŸ æ°´æœ</option>
                <option value="è”¬èœ">ğŸ¥¦ è”¬èœ</option>
                <option value="é¤…ä¹¾">ğŸª é¤…ä¹¾</option>
                <option value="ç”Ÿé®®">ğŸ£ ç”Ÿé®®</option>
                <option value="é»å¿ƒ">ğŸ° é»å¿ƒ</option>
                <option value="ä¹³/é£²æ–™">ğŸ¥¤ ä¹³/é£²æ–™</option>
                <option value="æ³¡éºµ">ğŸ æ³¡éºµ</option>
                <option value="è—¥">ğŸ’Š è—¥</option>
                <option value="èª¿å‘³">ğŸ§‚ èª¿å‘³</option>
                <option value="å…¶ä»–">â“ å…¶ä»–</option>
            </select>
        </div>

        <ul id="mola-list-harvest">
            <li
                style="text-align: center; color: var(--mola-soil); font-family: var(--mola-font-normal); font-weight: 700; padding: 20px;">
                ç›®å‰å€‰åº«æ²’æœ‰ä»»ä½•ä½œç‰©ï¼Œå¿«å»æ¡é›†å§ï¼
            </li>
        </ul>

        <h2 id="mola-history-title" style="display: none;">ğŸ“œ æ­·å²è³‡æ–™ (å·²éæœŸ)</h2>
        <ul id="mola-list-history">
        </ul>

    </div>

    <script>
        const molaFormSeedbox = document.getElementById('mola-form-seedbox');
        const molaListHarvest = document.getElementById('mola-list-harvest');
        const molaListHistory = document.getElementById('mola-list-history');
        const molaHistoryTitle = document.getElementById('mola-history-title');
        const purchaseDateInput = document.getElementById('purchaseDate');
        const categoryFilter = document.getElementById('category-filter');

        function setTodayDate() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            const todayString = `${yyyy}-${mm}-${dd}`;
            purchaseDateInput.value = todayString;
            purchaseDateInput.max = todayString;
        }
        setTodayDate();

        let foods = JSON.parse(localStorage.getItem('foods')) || [];

        function calculateDaysLeft(expiryDate) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const expiry = new Date(expiryDate);
            expiry.setHours(0, 0, 0, 0);
            const differenceMs = expiry.getTime() - today.getTime();
            return Math.ceil(differenceMs / (1000 * 60 * 60 * 24));
        }

        function renderFoodItem(food, index) {
            const daysLeft = calculateDaysLeft(food.expiryDate);
            let statusClass = 'status-safe';
            let statusText = `${daysLeft} å¤©å¾Œè®Šè³ª`;

            if (daysLeft < 0) {
                statusClass = 'status-expired';
                statusText = `å·²éæœŸ ${Math.abs(daysLeft)} å¤©`;
            } else if (daysLeft < 3) {
                statusClass = 'status-danger';
                statusText = `å¿«å£äº†ï¼å‰© ${daysLeft} å¤©ï¼`;
            } else if (daysLeft < 7) {
                statusClass = 'status-low';
                statusText = `å‰© ${daysLeft} å¤©`;
            }

            const formatDate = (dateString) => new Date(dateString).toLocaleDateString('zh-TW', { month: 'numeric', day: 'numeric' });

            const listItem = document.createElement('li');
            listItem.className = 'mola-item-produce';

            listItem.innerHTML = `
                <div class="mola-item-details">
                    <div class="mola-item-name">${food.name} (x${food.quantity})</div>
                    <div class="mola-item-dates">
                        <span>è³¼è²·æ—¥æœŸ: ${formatDate(food.purchaseDate)}</span> -------- <span>åˆ°æœŸæ—¥: ${formatDate(food.expiryDate)}</span>
                    </div>
                </div>
                <div class="mola-item-days-left ${statusClass}">
                    ${statusText}
                </div>
                <button class="mola-delete-btn" data-index="${index}">X</button> 
            `;

            // æ ¹æ“š daysLeft æ±ºå®šé …ç›®è¦æ”¾å…¥å“ªå€‹æ¸…å–®
            if (daysLeft < 0) {
                molaListHistory.appendChild(listItem);
            } else {
                molaListHarvest.appendChild(listItem);
            }
        }

        function renderFoodList() {
            const selectedCategory = categoryFilter.value;
            const filteredFoods = foods.filter(food => {
                return selectedCategory === 'all' || food.category === selectedCategory;
            });

            // åˆ†é›¢æ­£å¸¸åº«å­˜å’ŒéæœŸè³‡æ–™
            const currentFoods = filteredFoods.filter(food => calculateDaysLeft(food.expiryDate) >= 0);
            const expiredFoods = filteredFoods.filter(food => calculateDaysLeft(food.expiryDate) < 0);

            // æ’åºï¼šå¤©æ•¸å°‘çš„æ’åœ¨å‰é¢
            currentFoods.sort((a, b) => calculateDaysLeft(a.expiryDate) - calculateDaysLeft(b.expiryDate));
            // æ­·å²è³‡æ–™æŒ‰éæœŸå¤©æ•¸æ’åº
            expiredFoods.sort((a, b) => calculateDaysLeft(a.expiryDate) - calculateDaysLeft(b.expiryDate));

            molaListHarvest.innerHTML = '';
            molaListHistory.innerHTML = '';

            // æ¸²æŸ“æ­£å¸¸åº«å­˜
            if (currentFoods.length === 0) {
                molaListHarvest.innerHTML = `<li style="text-align: center; color: var(--mola-soil); font-family: var(--mola-font-normal); font-weight: 700; padding: 20px;">
                                                  ${selectedCategory === 'all' ? 'ç›®å‰çš„å€‰åº«æ¸…å–®æ˜¯ç©ºçš„å–”ï¼' : `ã€Œ${selectedCategory.replace(/[^ä¸€-é¾ A-Za-z]/g, '')}ã€é¡åˆ¥ä¸­æ²’æœ‰æœªéæœŸä½œç‰©ã€‚`}
                                               </li>`;
            } else {
                currentFoods.forEach(food => {
                    const originalIndex = foods.findIndex(item => item.name === food.name && item.expiryDate === food.expiryDate && item.purchaseDate === food.purchaseDate);
                    renderFoodItem(food, originalIndex);
                });
            }

            // æ¸²æŸ“æ­·å²è³‡æ–™
            if (expiredFoods.length > 0) {
                molaHistoryTitle.style.display = 'flex';
                expiredFoods.forEach(food => {
                    const originalIndex = foods.findIndex(item => item.name === food.name && item.expiryDate === food.expiryDate && item.purchaseDate === food.purchaseDate);
                    renderFoodItem(food, originalIndex);
                });
            } else {
                molaHistoryTitle.style.display = 'none';
            }

            document.querySelectorAll('.mola-delete-btn').forEach(button => {
                button.addEventListener('click', deleteFood);
            });
        }

        function saveFoods() {
            localStorage.setItem('foods', JSON.stringify(foods));
        }

        function addFood(event) {
            event.preventDefault();
            const category = document.getElementById('category').value;
            const name = document.getElementById('name').value.trim();
            const purchaseDate = document.getElementById('purchaseDate').value;
            const expiryDate = document.getElementById('expiryDate').value;
            const quantity = parseInt(document.getElementById('quantity').value);

            if (!name || !expiryDate || quantity <= 0) {
                alert('è«‹ç¢ºèªæ‰€æœ‰æ¬„ä½éƒ½å·²æ­£ç¢ºå¡«å¯«ï¼Œæ‘©çˆ¾ä¸èƒ½å·æ‡¶å–”ï¼');
                return;
            }

            const newFood = { category, name, purchaseDate, expiryDate, quantity };
            foods.push(newFood);
            saveFoods();
            renderFoodList();

            document.getElementById('name').value = '';
            document.getElementById('expiryDate').value = '';
            setTodayDate();
            document.getElementById('quantity').value = 1;
        }

        function deleteFood(event) {
            const index = event.target.dataset.index;
            if (confirm(`ç¢ºå®šè¦å°‡ ${foods[index].name} å¾å€‰åº«åˆªé™¤å—ï¼Ÿé€™å¾ˆå¯æƒœï¼`)) {
                foods.splice(index, 1);
                saveFoods();
                renderFoodList();
            }
        }

        molaFormSeedbox.addEventListener('submit', addFood);
        categoryFilter.addEventListener('change', renderFoodList);
        renderFoodList();

    </script>
</body>

</html>